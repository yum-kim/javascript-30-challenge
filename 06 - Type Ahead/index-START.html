<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Type Ahead ðŸ‘€</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <form class="search-form">
    <input type="text" class="search" placeholder="City or State">
    <ul class="suggestions">
      <li>Filter for a city</li>
      <li>or a state</li>
    </ul>
  </form>
<script>
const endpoint = 'https://gist.githubusercontent.com/Miserlou/c5cd8364bf9b2420bb29/raw/2bf258763cdddd704f8ffd3ea9a3e81d25e2c6f6/cities.json';

//* êµ¬í˜„í•  ê²ƒ : íƒ€ì´í•‘ í•  ë•Œ íƒ€ì´í•‘í•˜ëŠ” ê¸€ìžì— ë§žëŠ” jsonë°ì´í„°ê°€ ëª©ë¡ì— ë³´ì—¬ì§
let cities;
let suggestions = document.querySelector(".suggestions");
let input = document.querySelector(".search");

window.addEventListener("load", request);
input.addEventListener("keyup", showPreview);

/* 1) http requestë¡œ json ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° */
async function request() {
  const obj = new XMLHttpRequest();

  obj.onreadystatechange = function() {
      if (obj.status == 200 && obj.readyState == 4) {
        cities = JSON.parse(obj.response);
      } else {
        cities = null;
      }
  }

    obj.open('get', endpoint, false); //falseë©´ ë™ê¸°ì ìœ¼ë¡œ ì‹¤í–‰
    obj.send();

    console.log(cities);
}

/* 2) ë‚´ê°€ ê²€ìƒ‰í•œ ê¸€ìžë¡œ ë°ì´í„° í•„í„°ë§í•˜ê¸° */
function filterCity(searchingText) {
  let regex = new RegExp(searchingText, 'gi');
  let res = cities.filter(element => {
    return element.city.match(regex) || element.state.match(regex);
  });
  
  return res;
}

/* 3) í™”ë©´ë‹¨ì— ë¿Œë ¤ì£¼ê¸° */
async function showPreview() {
  let res = filterCity(this.value);

  let html = res.map(element => {
    let regex = new RegExp(this.value, 'gi');
    let cityName = element.city.replace(regex, `<span class="hl">${this.value}</span>`);
    let stateName = element.state.replace(regex, `<span class="hl">${this.value}</span>`);

    return `<li><span>${cityName}, ${stateName}</span></li>`;
  }).join('');

  console.log(html);

  suggestions.innerHTML = html;
}

</script>
</body>
</html>
